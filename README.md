# LUA.ZIG
<picture>
  <source media="(prefers-color-scheme: dark)" srcset="https://brainmade.org/white-logo.svg">
  <source media="(prefers-color-scheme: light)" srcset="https://brainmade.org/black-logo.svg">
  <img align="right" width="128" height="40" alt="Brainmade mark". src="https://brainmade.org/black-logo.svg">
</picture>

![License](https://img.shields.io/badge/License-MIT-green?style=for-the-badge&logo=MIT)
![Zig](https://img.shields.io/badge/Zig-%23F7A41D.svg?style=for-the-badge&logo=zig&logoColor=white)

A thin wrapper over [Lua 5.5](https://www.lua.org/manual/5.5/), providing all the goodies of it !

For the time being, **THE WRAPPER IS AN EXPERIMENTAL PROJECT**. The API will change a bit until all the features
I want to provide are there.

For the time being, you can simply use the `lua` binding generated by the project and ignore the wrapper !

## Lua C API
To link / get a module of the Lua C API, one can do the following :
```sh
zig fetch --save=lua.zig https://codeberg.org/mathieu_cayeux/lua.zig
```

And in your `build.zig.zon`:
```zig
const lua_zig = b.dependency("lua.zig");
YOUR_MODULE.addImport("lua-zig", lua_zig.module("lua.zig"));
```

And voil√† ! You can start coding !

### Limitations
The build toolchain uses the [Translate C](https://codeberg.org/ziglang/translate-c) API to generate the bindings.
This is equivalent on older zig build to doing a `@cImport`, but the latter will be removed on later versions.

Note that because lua makes heavy use of macros to make inline calls of functions, some translated call will not work, namely because of [#164](https://codeberg.org/ziglang/translate-c/issues/164) which is a current bug that doesn't coerce `NULL` (the macro) to a pointer's `null`.

As such, some of the following code will get a compile-time error :

```zig
const my_str = lua.lua_tostring(L, -1);
```

will get :

```zig
// ERROR: error: expected type '[*c]usize', found '?*anyopaque'
pub inline fn lua_tostring(L: anytype, i: anytype) @TypeOf(lua_tolstring(L, i, NULL));
//                                                                             ^~~~
// -- snip --
// note: generic function instantiated here
const my_str = lua.lua_tostring(new_state, -1);
```

The fix is as follows :
```zig
const my_str = lua.lua_tostring(new_state, -1);
// TO
const my_str = lua.lua_tolstring(new_state, -1, null);
```

aka. copying what is after the `@TypeOf` in the declaration and swapping the values `NULL` to `null` where applicable.

## Lua Zig Wrapper
Hmm... This is so experimental that I will not provide a documentation for the time being to avoid doing twice the workload.

## License
I'm using [MIT](./LICENSE).
